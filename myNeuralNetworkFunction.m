function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 11-May-2018 11:49:15.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx2 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx2 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0135688490100462;0.984928362121443];
x1_step1.gain = [120.42158550763;241.335646839647];
x1_step1.ymin = -1;

% Layer 1
b1 = [-19.798977408627305152;-19.59994755070085759;-19.401020658441165523;19.202036737997662641;19.003050554037891118;18.804065744924493231;18.605080020440684763;18.40609611329801254;-18.210069097732549892;18.008126430502400694;17.809141644758675227;-17.610156828027577092;17.40950726645286295;-17.212187172340239982;17.013202353372811615;16.833038198895568627;-16.615232637944103544;-16.416247884823491177;16.217263061986930239;-16.017625733200240745;-15.819293416293996657;15.620308680370499133;-15.431456087292717783;15.185545798001756523;15.023354136637934175;14.819967656925756572;-14.625384477940151839;-14.426862551256879996;-14.227414833522317394;14.02877366417913052;-13.829445187839372267;-13.630003705425416172;13.447579173467987701;13.225411234517546077;-13.033505770204122598;-12.834521063019352027;12.644636519304556899;-12.436550821504937403;-12.243788753754468956;12.038581355071880097;-11.839596991313339203;-11.640612134930020005;11.547592636525873644;11.19141424132814322;10.942900857170258178;-10.845697656645077345;10.651415884728931971;10.447648808450704649;-10.247718376821511654;-10.049082947178591851;-9.8175083793255772946;9.600951709702842507;9.4485453832118881934;-9.2490474607155288567;-9.0538091680146308704;-8.8375956759758711456;8.6401727244698331987;-8.4572000125891584332;-8.3835697479831505774;-8.055654184665216988;-7.8449649060475117324;7.6523310473258430164;-7.5448111053107984603;-7.2563889567918469226;7.0301027023455331388;6.9306623116950065722;6.5970640533967506158;-6.46342798203645863;6.2753991068096182104;6.0693453478281629287;-5.8438274102368392704;5.6470323601123233459;-5.472571734169693336;-5.2737253254213163345;-5.0732835460462570865;4.8760613940256689602;4.6765564833411863432;-4.4965520721311875718;-4.2778699137365014948;4.0897881733671255233;3.9016512677979302559;-3.5923573093941274514;-3.4780757091075389376;3.2597512082275783563;2.8475296372675771295;-2.8747023876608341908;-2.6209628369836392991;-2.378624893444369004;2.3175401788722305163;2.0856624621140249509;1.8188714495110427372;-1.6926584323692195344;-1.4955555836650444856;-1.2915857964731827234;-1.0974852406780868375;-0.87695655845529341121;0.68873488988698317037;0.52289045354230456741;-0.31218964616603661621;-0.0048597837763083157059;-0.033987337533280190249;-0.31125036414667661688;-0.48204850347760591633;0.64821453385657301638;0.93861434605445559498;1.0765186305884120177;1.4100643007463939949;-1.55196134329635127;1.5951500081279539334;1.9504932297199588653;-2.0800472860989662749;-2.2942832831560036055;2.444624097896919146;2.6877693175186014862;-2.8817039712795340378;3.1332518689842023818;3.2958482183440858115;-3.484011009986463403;3.6878485208333220413;-3.8816724858230156059;3.8564827186314722951;-4.2924342862639424112;-4.4769812880858097515;4.7498102089572871165;4.8751534098844144793;5.0557804352138226989;-5.3567172731068994906;-5.5115604562785538434;-5.6721300851845013469;5.8028320474642027804;-6.1379088772821015496;6.2702393871786847868;-6.3075693307204341309;6.6644983300814777394;6.8636815219505633578;-6.8407992592557915756;-7.3119451063820788406;7.4627116801840820415;7.495839530617105062;7.8598987771814208259;8.0860570482279250371;-8.2448254132800222749;-8.456854970154282114;8.6941392051346344516;-8.8798839992684595046;8.955321176801133376;9.5115977822357749005;9.4448846458571633633;9.6507638987270407682;-9.8548208269999619802;-10.07971076135146582;10.247718377698825876;10.446703199818976771;-10.666773228167917509;-10.711500173023166482;-10.968871565629301656;11.232015457838201655;11.44162731400061972;-11.890995565051380112;-11.997425457060394649;-12.038581203427249022;-12.339042541606357162;-12.436551427906028522;12.63643410257364863;12.85987519637334664;-13.033505896439024241;-13.232490719623122288;13.431475542136654511;13.630460364968703502;-13.829445187827435149;14.028430042752930262;14.213036911696271147;-14.523428832329233984;14.624958995942602513;14.824369302121299441;15.023357196897546117;-15.222338947754563421;-15.395459532839225858;-15.620308593447452594;-15.819293416294017973;-16.028121929186308847;-16.217263063193705364;-16.432829278910681126;-16.615232656272002743;-16.763254038744982211;17.034945795339151431;-17.301296689300393439;17.428529399443888792;17.610156821912209324;17.809141644758675227;18.008126466762096385;18.200142475135219655;18.406096113298069383;18.605080936128011615;-18.786562698052929221;19.003050581830631671;-19.202035404683936548;-19.402997919817057237;19.60000505192247644;19.798989873223348468];
IW1_1 = [11.316558594604408938 -16.246104276615817241;14.332298524210814961 -13.659689718363182465;17.950405708695377882 -8.3536172616771544597;-19.585183997775065023 2.9018151367997049306;-19.78459277674604877 -0.75491013754108593492;-6.7538450067482314054 -18.611436756574004647;-19.763501247015227591 1.1849228195482661707;-16.655341062831347188 -10.705120927890767746;15.266715748184060075 -12.602759799016940434;-19.674992317897146421 -2.2123919413937880307;-13.442743978802514704 -14.535908444963757447;19.38072796898881478 4.0481333072250187399;-16.141830337516232419 11.467172730078061704;8.4828047632572634029 17.889718371244221373;-13.457944006265817549 -14.521836768267775142;-11.952767790818032978 15.764476717600885536;19.493019941124000383 3.4673008214475076194;17.143541499655533755 9.9044931647051175361;-16.163302886388411395 -11.434493421348744135;19.659624950651917175 -2.348777131117488981;14.651073504735528275 13.317133518848441653;-19.251655329827823238 -4.6231769855623499055;2.0747539809106791964 19.681313267507945852;-8.559569459121338042 17.884714907080862645;-10.065381501766891503 -17.049577563150489112;-19.726987340129987558 1.721044783740626416;17.918742000466846065 8.4213232414501195677;0.88833416391740693818 -19.778777845091681797;14.492719172366996361 13.489295422330473073;-17.685378928980423296 8.9003507443039886482;12.894545147943860641 15.024337104431348067;18.362800346518813654 -7.4042249099373158572;-19.509207506190968218 3.3077927540631582026;-2.3455925346405326337 -19.664212700286878288;10.653783195309047827 16.688226538266938803;17.704136784623173639 8.8636076649594031096;-12.363546966865438748 15.457903491883737246;10.467964267670772927 16.805407788263465818;7.0201861394000566463 18.509371926034415168;-10.099960990429394769 -17.029116046912275095;17.122449594303702725 9.9409114051773190823;15.531609792672709247 12.278806833612941674;-6.5184272223808843449 -18.628858653174170001;-12.883083235619089635 15.071088814335528383;-13.805455652246532594 14.268968065751952423;8.4617469373569225155 17.899264000057687696;-19.784559200180591887 -0.65729335254014731316;-1.3912382805434104771 19.748941856125483696;13.891700339301207734 14.107468294583956236;18.441720993114497418 7.2040103015676146825;17.285540449512801331 -9.689528239708748103;-7.799831580914914575 18.225617588182654316;-2.5008215875766985903 -19.637777575980116751;12.271237803733770377 -15.540544516235799577;12.701088033088796081 15.188231106882946975;9.5270830785966609255 17.362880642986855406;-9.3353075124365361148 -17.466611728809947834;17.733034801805587222 -8.8092109774933256006;1.2942516560685659588 -19.704329689705243567;12.458408656791657876 -15.389431706613184048;8.6562337543498415471 17.813318262973524497;-17.156592306712418861 9.8880976033932235225;3.3097652783545465915 19.48281785140409994;3.1858948600153071951 19.544305599179963906;-18.496332254188832422 7.0960376005571941249;-9.8734600382537358598 -17.134720991161170645;-19.65233970548898057 -2.5880574479449220959;9.8828528174994207944 -17.157477720064889581;-5.7102670946080600345 18.954847836469404854;-16.491805257621347636 -10.955263108005750539;8.2764925365816424119 17.994606682947193121;-19.740618499037786648 1.6050661584384222635;15.505349738828316575 12.31183899710066143;12.841567279866360707 15.069546354895614115;15.31867226762229528 12.543624618846456187;-19.479802382888703249 -3.5349167853377956305;-13.334479486436494611 -14.635243730025198516;16.316539520378562145 -11.209195022890977356;13.31194411817240919 14.655822278768740219;-1.1160835462039870869 19.766480985312810503;-7.9409097172502676187 -18.133098478850225632;16.601553952033402339 -10.815558744853870365;19.661305587506706871 2.3358977671868470516;-12.780769960599585033 -15.125074158437881167;-4.8136782255259173979 -19.240674105326078802;13.961205502719336025 -14.041797987875185072;12.514603325311272286 15.35692561153647695;6.8432599521218611116 18.591588685944518744;-18.522700739490939981 6.9758660549786952743;-17.84167631023298739 8.5912039259098182953;-10.639672797812497862 -16.706883811044441757;15.207657169769507988 12.677188616450123959;8.2914969586411721991 -17.97903453120678563;0.30232857299106541404 -19.795032781041982162;7.99068474484125435 18.113535345979176583;16.710013474584897608 -10.618987839263297701;-16.036146499888861428 -11.612507607557640554;-14.352166642972912669 -13.633575558217124524;10.968167768968255515 -16.482980018389906007;-18.641048099858846143 6.6805693597044921717;-14.67931951341411434 13.282201447589333299;-1.5667124278148949479 19.739989616589024735;-5.7463156183977037728 -18.94631924985380067;0.425920155387201127 -19.799934184815565885;0.089120521036411576299 19.799656630118448675;9.8635903857782292192 17.168062135935358015;19.638140571665751111 2.4682066277973757629;-2.6953546234280261196 19.610524879213357963;19.633461341401936551 -2.6054180828860116215;18.079037923789062603 -8.0594239708675843303;-8.5640024683592201882 -17.851510919455996884;-9.5752166686475685964 -17.326274876206788633;18.867736462654757901 -6.009580042359432106;18.315875836189480452 -7.5172786752926681331;-12.828878026770373921 -15.080713416300698171;19.540449902439053886 -3.1152224766765841402;16.699989618474855746 -10.63675299549974973;-14.939786441499991909 -12.992041621035495425;19.743208484016786741 -1.4666162943920117989;-19.142202774550604261 -5.0090848083035002247;0.14464826220154314296 -19.845543823522472593;-11.9893618485088993 15.751876350895798851;-12.318014947182692964 -15.500549907436896646;17.112596622575221517 -9.9195525473668766381;14.276219208230260804 13.718219517038873434;1.225693631945789619 19.765285600876875804;-10.933682240093277827 16.477319098426622901;-10.896830739009569555 16.516740973795045022;-19.796099838655919712 0.68880617910642305546;18.798728755769548826 6.2855716844689553113;-19.756651705861994373 0.79595483181160475716;15.243289578706006537 -12.633754319204024696;-13.028586077704760626 14.974431109870597112;5.3028338642181829243 19.07525061874401473;16.51713778011231426 10.917767619869955809;-19.866118437818801823 0.58834355628596912702;-10.757137133998536882 16.604908368302989885;17.520656521594258237 -9.2170774869007079388;19.785728369255053849 -1.6993432482886672297;11.194887492491726988 16.330171491476008327;12.73536027898011902 -15.140593717460424372;-0.095239649369926224209 -19.8038050102673715;-14.648918186058846658 -13.319504344478859892;15.985262499522539414 -11.65235840070292106;-0.39607324610813143817 -19.785821677540759822;19.26216355371574096 -4.7712604227227055631;11.018992905009270089 -16.313686080985650761;18.134767369822611727 -7.9533652042069666877;11.973655168585429109 15.768055743695713389;-19.565203306224471902 -3.0201096405501757225;-17.980551728368975972 -8.2546827974887904134;14.370612201758623527 13.619306331309909197;14.126191146822566935 13.87266101666003415;-9.6063147058026370217 17.298494103117974419;-17.60422933874396989 9.2199086616738004096;-13.319199625719106095 14.708270170216229289;18.197171069953679279 7.8130550718636841978;11.296088542293675872 16.260331596968118362;-14.65252107391512304 13.10544589427934703;-0.8473900890746982606 19.684485911993185425;-17.045932684972029847 -10.071553313628934134;-18.661388020489958706 6.4205048568310241208;-11.9827984998552175 -15.761108467105387376;19.687576747076771966 -2.0920848794637207924;19.435913758990892575 -3.6761345831896075076;-12.864249126396936518 -15.0502855259960171;-15.678852362431870304 -12.090226986896706052;14.236580173525490878 13.759352636035639961;11.123872865927472375 16.378627917586353391;-12.654526011035972743 -15.227047364345425606;17.114330801674388027 9.9548822604306188566;19.550036253728066526 -3.2030118267605822702;-16.119606352499740609 11.38821246207251825;19.023938889261149399 5.4894061903024713445;15.766096168294843949 11.976235285415633314;0.37298599921554076442 19.795474597201923928;-14.809708934939948222 -13.140491667451424718;-1.8625502674338478837 19.735702114117824379;-14.866326720146931351 -13.076403551812168402;-13.153844244541586406 -14.797850573321118972;-18.226597183731136909 7.7062748683942885464;-17.424140650043383971 -9.4020913945851258831;-19.550569923394458982 -3.0424942688675358227;-18.358392550364825979 -7.4141365622645434286;-17.222533038571359754 9.8707024152764351044;11.462349373416733656 -16.113157347372872863;-11.650628695641868759 15.899782619207510237;3.9960964323490557604 -19.376000581837114822;13.643156042462344146 14.347971745198805138;13.851100456354902946 14.147332474638639965;3.4012848932293042736 19.504647166511588807;18.886435504076992231 -5.9625881556817628137;15.935573344410668639 11.749787325092663437;17.54962399742045065 9.165734970497389611;-14.95805731305214259 12.996118754161768649;17.392979365780600887 9.4596125069487815296;-12.377490200894605721 -15.453081774415030836;-19.65595379741868598 -2.3600470129083990223;0.39742138869681659097 19.795000788232826494;7.5221354074880828477 18.31440632156592585];

% Layer 2
b2 = [-0.12407678154538111237;-0.32203749733217207352];
LW2_1 = [0.01355695024479600802 -0.78689815075179603276 -0.23139914091371879823 0.63168612123261613789 -0.15497584130423294746 0.4231199493256108668 -1.011216664679897681 -0.15172971165131973748 -0.15016819994048291598 -0.17514279575074545581 0.63756484540174196418 0.2818968428456196107 -0.29545610520618759143 0.24814485877194070174 0.066030031529659125034 0.67918536484775848816 -0.099415742806849838331 0.89605866620446683601 0.0041284733261574921986 0.89634642357884874997 -0.20545533605864169102 0.70124628804375210844 -0.62603931545354918331 -0.76173920663339356185 0.22118299735350815949 -0.95470154979025556585 0.99802902747697563868 -0.61698199340015624781 0.1838998581885439576 0.64764993022047656623 -0.13003180960059926297 -0.28421777983672080747 0.82797248058076933219 -0.18833248416526279789 0.22581566296252875148 0.59405782894288983176 -0.83426090606831071472 -0.094113011062853982325 0.099390948694256187057 -0.27676228791333207235 -0.3267370134217129074 0.16241658820033672006 0.88607135542948178841 -0.28077141819200379658 1.0002248764789594127 0.62688011692583323065 0.23975125062619678795 -0.2781067037377292217 -0.56139132508112443709 -0.74807562789583226248 -0.22014119214428559679 0.75759296518386809449 0.030905170874774266082 0.234517209708809099 0.60454836945525347591 0.57427432319864113452 -0.25096229830259197957 -1.0259208494789593402 0.737888330966463446 0.025893311550434700008 -0.66866174187437366072 -0.43531659820767937275 0.54445151738410091369 0.24308835792416078059 -0.45130534919923293025 0.72036486207464689446 0.80709359739851072035 0.1419317681101297246 -0.42389658575754252112 0.82578451530270136072 -0.91395551884069836657 -0.64286012537871239925 -0.71074757940705834969 -0.72533258759912300206 0.9577547836077893173 0.27174597384240711806 0.47564453493859154554 -0.86557112107545586266 -0.2847003359605626005 0.96441642550997019878 0.61177871609712175527 0.92228927790539771969 -0.13535630975806547949 -0.57681809237318892869 0.55207984436336476897 -0.7314099576377155465 0.68033109622211107581 -0.11428851267184220175 -0.02109558598986240735 -0.99350653940708089085 -0.86177382717659911648 -0.098496111883618703287 0.11278252561381123253 0.25237625458150547697 -0.017248077619850289699 -0.37773138590673088766 -0.40054034503220908858 0.46862152155310038415 0.91728074539548487554 0.69549624558482758818 0.056219380572426203013 0.58492695457522903002 -0.6924475772675581231 -0.46939797954889866949 -0.82757888511397215137 0.23783096405653433858 0.73836924619226340649 -0.059355309883095022649 -0.52949414141940009948 1.0605664478222329716 0.9291991073882602814 0.20568290256931437421 -0.67267325506336173024 -0.78655490925800819468 -0.8490848601797296169 -0.29831541083499607536 0.54777791990262447719 0.0047420305479112740202 0.29242252550565850377 -0.39159011861598091997 0.99014957442753270822 -0.12042246006685647375 0.054475714140258910123 -0.26643967003713736608 0.30374920590618853522 -0.69368221507603167186 0.74131433766266896512 0.21064105501081559213 0.29989654468793530695 0.3011362084812588269 0.42415694509087598085 -0.51455473783275329502 -0.79202511752982629467 0.51817004703121261056 -0.37731735560869472668 0.80680503475813847292 0.1240093620602059632 -0.36948229688915729119 -0.82593844714990538591 0.76800877339165241064 0.33889262994239460758 0.07300642008200937394 0.60940309092290023685 0.63739439172270306866 0.9427682146111282524 -0.31499660927753597717 0.84241239094045483604 -0.82322168902248993305 0.87433300441111860835 0.73354797731586174336 -0.86252698273665817652 -0.91603094912458249421 -0.92362433281825528919 -0.57239901016653549348 0.794270674486934114 -0.40847461424015640841 -1.0074846948498035193 0.11916693478251488836 -0.65815042649774080363 -0.45800553402934612857 -0.051429810726374813878 0.80776914439253777456 0.4024416141964820004 0.040319108194059663508 0.092208700221633507765 -0.29401848660219803699 -0.78545063842487417016 -0.8154249120463861189 0.67086473347630692921 -0.53540757782002557086 -0.20070602655007704906 -0.1761931999412270633 0.54085576987474903721 0.42552154191749297363 0.74459165609330668634 -0.53192817418929838613 0.044649135505058487605 0.37006847597292852337 0.80320992100957555593 0.58399953895875944543 0.75168343962264760894 0.6209546288973625261 0.61143478597837885857 0.079058796514961934832 -0.66869572285932132871 -0.77759900814824989279 0.744841460114478493 0.4234932946446711699 -0.08412081609850217967 0.25415411708832047477 -0.57376076267528774988 0.21639491379157033135 -0.26324485988768087097 0.056098166152126573147 -0.55187006623652523629 0.26293905622072039074 -0.64911658982885922509 0.11958003155868475453 0.59791498570957535286 0.16403690716745519818;-0.12941951212156832529 -0.99404062389467606753 -0.19648439865342670618 -0.062168402225579434683 0.26168132866945181814 -0.32779452947269110963 -0.27416213855573590141 0.7754238579251873098 0.68850001691286799588 0.27594630766597366689 0.33249950068088485189 0.713995109052840915 -0.15326628685674939523 -0.22498747994282614071 -0.10477870097449715203 -0.18037018298953169659 -0.35718853181224047288 0.20410197193508478053 0.0034739849276351087576 -0.040645101592177643179 -0.60875691457306779775 0.43287739694598897922 -0.093304429027057836366 0.67806184159861826455 -0.8320684630674403115 0.228429673694009433 0.84276135170217458814 0.48604630003065002475 0.23735915163202891964 0.67072667923699880177 0.3717264769199508101 -0.7005314214615041557 0.17375464763347517327 0.065881891034107964433 -0.82855838735399356398 0.53049387310215267988 0.39782307596203958511 -0.98911809543456741256 0.63887002130497194674 -0.20324889806888060684 -0.037476262797549467209 -0.75132363670562829494 -0.27525224572369516585 -0.97797133195221153112 -0.25275246806990714354 0.95367817164369639293 -0.37697409422102778898 -0.92541279656074360016 -0.40008741369776917862 -0.016759257430354727175 0.42668817292077682035 -0.068967595975336012937 -0.31192994261940260037 0.75582818897956149939 0.12518825420277804317 -0.80089229673288042655 0.20245815032967071079 0.5030646877293450947 -0.80693084889279498295 -0.072476290222669798036 -1.0245273146093596406 -0.13455697390628426624 0.21090630831928575128 0.57924844201646108477 0.8978913663208016871 0.083504754012698190202 -0.062205194630197295502 -0.041165938206342081451 -0.91457209500932501456 0.62332057272789809232 -0.70064771848281581779 0.41019090659979867697 0.68906031710330761797 0.23935132399731809394 -0.75989164463077818468 0.55932527563264589077 -0.53654876609524604358 -0.17819796006792040788 -0.5897946074820944462 -0.36057366219288156106 0.34284863440664553602 -0.052629665561254396211 -0.20404891158932669804 0.15367659238968417457 -0.95343450006012075981 -1.0169784907399053164 -0.40437511764086458976 0.6482669110140801827 -0.80893707749272536489 0.7808492325300077086 0.52012169055474932744 0.21458091495215453337 -0.037706795329186061638 0.8764106372307471915 -0.21873225381755717622 -0.09291131660393053826 -0.24016899250256967813 -0.69539675179694004914 0.87369335352707611086 -0.39871930485185680393 0.6185295917327294779 -0.14547626038619462796 0.11421927134325264575 0.43159163349145962529 0.34554771860623489932 0.59071743457144676448 -0.41025185317934093066 0.45665510739928272255 0.34330847693331223436 0.50133630064069312215 0.7028510101644857011 -0.62830771682267239076 0.0041924942835129923313 -0.85673270689130243127 0.13828520262340252001 0.51201327892120751528 -0.38459899991180085399 0.49102773807653388172 0.23732559569851341408 0.71128687188820527432 -0.46417802254646894911 -0.15089321696697519104 0.64474933242052867577 0.46198318957699802123 0.99109291753445194484 0.054133138714889630916 0.11380562061541447949 -0.050517902496823322012 -0.98074607645609457318 -0.25498278615885189291 0.8325994985635192247 -0.40179601199394077149 0.23061536988043238039 0.16006798961476670362 -0.26321557376558468722 -0.36204573520785804375 -0.80640110434257739058 -0.29047234422419743183 0.25881463053265174601 -0.88265072342473593903 0.19656530591828827448 0.25438962166414125221 0.61072575320831512524 0.60280034550376093705 -0.43450526879413936543 0.75019771247806554815 -0.99043047386895699535 -0.88171368896422563921 0.23622633648690086194 0.88965936271703316418 -0.16254699018647197906 0.61984147057292793281 -0.21771144948129381169 -0.22957123543981813873 0.23113992938488442386 -0.81449390391071163631 0.030700745664866191387 0.55663111693907874056 1.1872925669001366256 0.79914417887590671885 -0.16440578913834383301 0.57155566932319257223 0.37497852627289990357 0.047293641592940888208 -0.018100847357429342838 0.50881377651958736852 -0.24474672865145727374 -0.66437389259877499548 -0.67858716885792957907 0.75399937629080748813 -0.55478027874190372071 -0.46844396454672138086 -0.40986316329720201557 -0.80568354286929855235 -0.7700802199902859746 -0.67433656288605992035 -0.48783931141564856881 -0.80873074713486858833 -0.48671287298492627027 0.43101287156705159198 0.46872034384281779928 0.88618544032447155168 0.86725322320069497817 -0.94766169449536474811 0.85969949833912195913 0.17091637466721554262 -0.86758154320720481945 0.10437785428568460699 0.57424982497659826652 0.8668655558220261792 0.095261282172572792071 0.51232516536606875768 -0.25256889370291524255 0.20278108114369930437 -0.59471329740969303135 0.59738793009021906588 -0.38863134176850194779 -0.99093479362497050023 0.028570901487101400124 -0.24051261731547660117];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
